<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Love â€” ØªØ¬Ø§Ø±Ø¨ Ø§Ù„Ù‚Ù„Ø¨</title>
  <!-- html2canvas for export -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <style>
    html,body{height:100%;margin:0;background:#000;font-family:system-ui,-apple-system,Segoe UI,Roboto,'Noto Sans',sans-serif;color:#fff}
    .wrap{position:relative;width:100%;height:100vh;overflow:hidden;display:flex;align-items:center;justify-content:center;perspective:900px}
    canvas{position:absolute;left:0;top:0;width:100%;height:100%;display:block}
    #bgCanvas{z-index:1}
    /* Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„ØªÙŠ Ø³Ù†ØªØ­ÙˆÙ„ Ø¹Ù„ÙŠÙ‡Ø§ 3D */
    #heartWrapper{position:absolute;left:0;top:0;width:100%;height:100%;z-index:2;display:flex;align-items:center;justify-content:center;transform-style:preserve-3d;cursor:grab}
    #heartCanvas{pointer-events:none}
    /* ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªØ­ÙƒÙ… */
    #ui{position:absolute;left:12px;top:12px;z-index:12;background:rgba(0,0,0,0.28);padding:8px;border-radius:10px;display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    #ui input[type=text]{width:160px;padding:4px}
    #ui label{font-size:13px}
    button{background:#222;color:#fff;border:0;padding:6px 8px;border-radius:6px}
    /* Ø±Ø³Ø§Ù„Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„Ù‚Ù„Ø¨ */
    #messagePreview{position:absolute;z-index:8;pointer-events:none;left:50%;top:50%;transform:translate(-50%,-50%);text-align:center}
  </style>
</head>
<body>
  <div class="wrap">
    <canvas id="bgCanvas"></canvas>

    <!-- Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø«Ù„Ø§Ø«ÙŠØ© Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ Ù„Ù„Ù‚Ù„Ø¨ -->
    <div id="heartWrapper">
      <canvas id="heartCanvas"></canvas>
    </div>

    <div id="ui">
      <label>Ù„ÙˆÙ† Ø§Ù„Ù‚Ù„Ø¨: <input id="colorPicker" type="color" value="#ff2d55"/></label>
      <label>Ø§Ù„Ø±Ø³Ø§Ù„Ø©: <input id="msgInput" type="text" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ø³Ø§Ù„ØªÙƒ"/></label>
      <button id="applyMsg">ØªØ·Ø¨ÙŠÙ‚</button>
      <button id="exportBtn">ØªØµØ¯ÙŠØ± PNG</button>
      <label>Ø£ÙˆØ¯ÙŠÙˆ: <input id="audioFile" type="file" accept="audio/*"/></label>
      <button id="playAudio">ØªØ´ØºÙŠÙ„</button>
      <label>Ù†Ø¨Ø¶: <input id="pulseRange" type="range" min="0.5" max="3" step="0.05" value="1"/></label>
    </div>

    <div id="messagePreview"></div>
  </div>

  <script>
  // ==== Ø¹Ù†Ø§ØµØ± ÙˆÙ…Ù‚Ø§ÙŠÙŠØ³ ====
  const bgCanvas = document.getElementById('bgCanvas');
  const heartCanvas = document.getElementById('heartCanvas');
  const heartWrapper = document.getElementById('heartWrapper');
  const bgCtx = bgCanvas.getContext('2d');
  const ctx = heartCanvas.getContext('2d');

  const colorPicker = document.getElementById('colorPicker');
  const msgInput = document.getElementById('msgInput');
  const applyMsg = document.getElementById('applyMsg');
  const exportBtn = document.getElementById('exportBtn');
  const audioFile = document.getElementById('audioFile');
  const playAudio = document.getElementById('playAudio');
  const pulseRange = document.getElementById('pulseRange');
  const messagePreview = document.getElementById('messagePreview');

  let W = innerWidth, H = innerHeight;
  function resizeAll(){ W = innerWidth; H = innerHeight; [bgCanvas, heartCanvas].forEach(c=>{ c.width=W; c.height=H }); centerX = W/2; centerY = H/2 }
  window.addEventListener('resize', resizeAll);
  let centerX= W/2, centerY= H/2; resizeAll();

  // Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø§Ù„Ù‚Ù„Ø¨ (Ø·Ø±ÙŠÙ‚ØªÙ‡ Ø§Ù„ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠØ©)
  function heartX(k){ return 15*Math.pow(Math.sin(k),3) }
  function heartY(k){ return 12*Math.cos(k)-5*Math.cos(2*k)-2*Math.cos(3*k)-Math.cos(4*k) }

  // ======== Ø®Ù„ÙÙŠØ© Ù‚Ù„ÙˆØ¨ Ù…ØªØ¹Ø¯Ø¯Ø© Ø§Ù„Ø·Ø¨Ù‚Ø§Øª + ÙÙŠØ²ÙŠØ§Ø¡ Ø¨Ø³ÙŠØ·Ø© ========
  const spaceHearts = [];
  const SPACE_COUNT = 160;
  function initSpace(){ spaceHearts.length=0; for(let i=0;i<SPACE_COUNT;i++){ spaceHearts.push({ x:Math.random()*W, y:Math.random()*H, z:Math.random()*3+0.4, hue:Math.random()*360, sizeBase:0.6+Math.random()*1.8, vx:0, vy:0, mass: 0.5+Math.random()*1.5 }) } }
  initSpace();

  // Ø¬Ø²ÙŠØ¦Ø§Øª Ù„Ù„Ø§Ù†ÙØ¬Ø§Ø±Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø±
  const particles = [];
  function spawnBurst(x,y,color,count=28){ for(let i=0;i<count;i++){ const a = Math.random()*Math.PI*2; const s = (Math.random()*4+1); particles.push({x,y,vx:Math.cos(a)*s,vy:Math.sin(a)*s,life:60,size:1+Math.random()*3,color}) } }

  // ØªØªØ¨Ø¹ Ø§Ù„Ù…Ø§ÙˆØ³ Ù„ØªØ£Ø«ÙŠØ± Ø§Ù„ØªÙ‡Ø±Ø¨
  const mouse = {x:null,y:null,down:false};
  window.addEventListener('mousemove', e=>{ mouse.x=e.clientX; mouse.y=e.clientY });
  window.addEventListener('mouseleave', ()=>{ mouse.x=null; mouse.y=null });
  window.addEventListener('mousedown', e=>{ mouse.down=true; spawnBurst(e.clientX,e.clientY,colorPicker.value,22) });
  window.addEventListener('mouseup', ()=>{ mouse.down=false });

  // ÙÙŠØ²ÙŠØ§Ø¡ Ø¨Ø³ÙŠØ·Ø©: Ø¬Ø§Ø°Ø¨ÙŠØ© ØµØºÙŠØ±Ø©ØŒ ØªØµØ§Ø¯Ù… Ø¨Ø³ÙŠØ· Ø¨ÙŠÙ† Ø¹Ù†Ø§ØµØ± Ù‚Ø±ÙŠØ¨Ø©
  function updateSpace(){
    const g = 0.02;
    for(let i=0;i<spaceHearts.length;i++){
      const h = spaceHearts[i];
      // Ø¬Ø°Ø¨ Ù†Ø­Ùˆ Ø§Ù„Ø£Ø³ÙÙ„ Ø­Ø³Ø¨ Ø§Ù„Ø¹Ù…Ù‚
      h.vy += 0.02 * h.z;

      // ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ù…Ø§ÙˆØ³: Ø§ÙØ±Ù Ù…Ù†Ù‡
      if(mouse.x!==null){ const dx = h.x - mouse.x, dy = h.y - mouse.y; const d = Math.sqrt(dx*dx+dy*dy); const thresh = 110*h.z; if(d<thresh && d>0){ const f = (thresh-d)/thresh*6; h.vx += (dx/d)*f; h.vy += (dy/d)*f } }

      // Ø­Ø±ÙƒØ©
      h.vx *= 0.93; h.vy *= 0.93;
      h.x += h.vx; h.y += h.vy;

      // Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø´Ø§Ø´Ø©
      if(h.x< -40){ h.x = W+10; h.y = Math.random()*H }
      if(h.x> W+40){ h.x = -10; h.y = Math.random()*H }
      if(h.y> H+30){ h.y = -20; h.x = Math.random()*W }

      // ØªØ¯Ø§Ø®Ù„ Ø¨Ø³ÙŠØ·: Ø§Ø¯ÙØ¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…ØªÙ‚Ø§Ø±Ø¨Ø© (ØªØ¨Ø³ÙŠØ· n^2)
      for(let j=i+1;j<spaceHearts.length;j++){ const b=spaceHearts[j]; const dx=h.x-b.x, dy=h.y-b.y; const dist=Math.sqrt(dx*dx+dy*dy); const minD=(h.sizeBase*h.z + b.sizeBase*b.z)*6; if(dist>0 && dist<minD){ const push=(minD-dist)/minD*0.3; h.vx+= (dx/dist)*push; h.vy+= (dy/dist)*push; b.vx-= (dx/dist)*push; b.vy-= (dy/dist)*push } }
    }
  }

  function drawSpaceBackground(){
    bgCtx.clearRect(0,0,W,H);
    for(const h of spaceHearts){
      const r = h.sizeBase * h.z;
      bgCtx.fillStyle = `hsl(${h.hue},90%,60%)`;
      bgCtx.textAlign='center'; bgCtx.textBaseline='middle';
      bgCtx.font = `${Math.max(9, Math.round(r*8))}px serif`;
      bgCtx.fillText('â¤', h.x, h.y);
    }
    // Ø¬Ø²ÙŠØ¦Ø§Øª Ø§Ù„Ø§Ù†ÙØ¬Ø§Ø±
    for(let i=particles.length-1;i>=0;i--){ const p=particles[i]; p.x+=p.vx; p.y+=p.vy; p.vy+=0.06; p.vx*=0.99; p.vy*=0.99; p.life--; bgCtx.fillStyle=p.color; bgCtx.beginPath(); bgCtx.arc(p.x,p.y,p.size,0,Math.PI*2); bgCtx.fill(); if(p.life<=0) particles.splice(i,1) }
  }

  // ======== Ø±Ø³Ù… Ø§Ù„Ù‚Ù„Ø¨ ÙˆØªØ®Ø²ÙŠÙ† Ø§Ù„Ù†Ù‚Ø§Ø· Ù„Ù„Ù†Ø¨Ø¶ ========
  let stepI=0, prevX=null, prevY=null; const heartPoints=[]; let isPulsing=false; const numSteps=3200; const baseScale=20;
  function drawHeartStep(){
    const t = stepI/60; // parameter smoother
    const x = heartX(t) * baseScale + centerX;
    const y = -heartY(t) * baseScale + centerY;
    const hue = (stepI/numSteps)*360;
    ctx.strokeStyle = colorPicker.value; ctx.lineWidth=2;
    if(prevX!==null){ ctx.beginPath(); ctx.moveTo(prevX,prevY); ctx.lineTo(x,y); ctx.shadowColor=ctx.strokeStyle; ctx.shadowBlur=18; ctx.stroke(); ctx.shadowBlur=0 }
    heartPoints.push({dx:x-centerX, dy:y-centerY, hue}); prevX=x; prevY=y; stepI++;
    if(stepI < numSteps) requestAnimationFrame(drawHeartStep); else { isPulsing=true; pulseHeartStart() }
  }

  // Ù†Ø¨Ø¶ Ø§Ù„Ù‚Ù„Ø¨: Ù†Ø¹ÙŠØ¯ Ø±Ø³Ù… Ø§Ù„Ù…Ø³Ø§Ø± Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ù…Ø¹ Ù…Ù‚ÙŠØ§Ø³ Ù…ØªØºÙŠØ± ÙˆÙ…ØªØ²Ø§Ù…Ù† Ù…Ø¹ Ø§Ù„ØµÙˆØª
  let pulseSpeed = 1, audioBeat=0;
  pulseRange.addEventListener('input', ()=>{ pulseSpeed = Number(pulseRange.value) })
  function pulseHeartStart(){ isPulsing=true; requestAnimationFrame(pulseHeart) }
  function pulseHeart(){ if(!isPulsing) return; ctx.clearRect(0,0,W,H);
    const t = Date.now(); const s = 1 + 0.04 * Math.sin(t/160*pulseSpeed) * (1+audioBeat*1.4);
    ctx.save(); ctx.translate(centerX,centerY); ctx.scale(s,s); ctx.lineWidth=2;
    ctx.shadowBlur = 24 * (1+audioBeat); for(let i=1;i<heartPoints.length;i++){ const a=heartPoints[i-1], b=heartPoints[i]; ctx.beginPath(); ctx.moveTo(a.dx,a.dy); ctx.lineTo(b.dx,b.dy); ctx.strokeStyle = colorPicker.value; ctx.shadowColor = colorPicker.value; ctx.stroke() }
    ctx.shadowBlur = 0; ctx.restore();
    // Ø±Ù†Ø¯Ø± Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„Ù‚Ù„Ø¨
    drawMessage(s);
    requestAnimationFrame(pulseHeart);
  }

  // Ø±Ø³Ù… Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„Ù‚Ù„Ø¨
  let currentMessage = '';
  function drawMessage(scaleFactor){ messagePreview.style.transform = `translate(-50%,-50%) scale(${scaleFactor})`; messagePreview.style.color = colorPicker.value }
  applyMsg.addEventListener('click', ()=>{ currentMessage = msgInput.value || ''; messagePreview.textContent = currentMessage })

  // ======== ØªØ¯ÙˆÙŠØ± Ø§Ù„Ù‚Ù„Ø¨ Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„Ø³Ø­Ø¨ (3D pseudo) ========
  let dragging=false, lastX=0, lastY=0, rotX=0, rotY=0;
  heartWrapper.style.pointerEvents='auto';
  heartWrapper.addEventListener('mousedown', e=>{ dragging=true; lastX=e.clientX; lastY=e.clientY; heartWrapper.style.cursor='grabbing' });
  window.addEventListener('mousemove', e=>{ if(!dragging) return; const dx=e.clientX-lastX, dy=e.clientY-lastY; rotY += dx*0.12; rotX -= dy*0.12; lastX=e.clientX; lastY=e.clientY; heartWrapper.style.transform = `rotateX(${rotX}deg) rotateY(${rotY}deg)` });
  window.addEventListener('mouseup', ()=>{ dragging=false; heartWrapper.style.cursor='grab' });

  // ======== ØªØµØ¯ÙŠØ± PNG Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… html2canvas ========
  exportBtn.addEventListener('click', ()=>{
    exportBtn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¶ÙŠØ±...';
    html2canvas(document.querySelector('.wrap'),{backgroundColor:null,scale:1}).then(canvas=>{
      const a=document.createElement('a'); a.href=canvas.toDataURL('image/png'); a.download='love.png'; a.click(); exportBtn.textContent='ØªØµØ¯ÙŠØ± PNG'
    }).catch(()=>{ exportBtn.textContent='ØªØµØ¯ÙŠØ± PNG' })
  })

  // ======== WebAudio Ù„Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨Ø³ÙŠØ· (Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹ Ø§Ù„Ù†Ø¨Ø¶) ========
  let audioCtx, analyser, audioEl, sourceNode;
  audioFile.addEventListener('change', ()=>{
    const f = audioFile.files[0]; if(!f) return; const url = URL.createObjectURL(f);
    if(!audioEl){ audioEl = new Audio(); audioEl.crossOrigin='anonymous'; audioEl.loop=true }
    audioEl.src = url; audioEl.play(); playAudio.textContent='Ø¥ÙŠÙ‚Ø§Ù';
    if(!audioCtx){ audioCtx = new (window.AudioContext||window.webkitAudioContext)(); analyser = audioCtx.createAnalyser(); analyser.fftSize = 256; sourceNode = audioCtx.createMediaElementSource(audioEl); sourceNode.connect(analyser); analyser.connect(audioCtx.destination) }
  });
  playAudio.addEventListener('click', ()=>{
    if(!audioEl) return; if(audioEl.paused) { audioEl.play(); playAudio.textContent='Ø¥ÙŠÙ‚Ø§Ù' } else { audioEl.pause(); playAudio.textContent='ØªØ´ØºÙŠÙ„' }
  });

  function updateAudioBeat(){ if(analyser){ const arr = new Uint8Array(analyser.frequencyBinCount); analyser.getByteFrequencyData(arr); let sum=0; for(let v of arr) sum+=v; const avg = sum/arr.length; audioBeat = Math.min(1, avg/120); } else audioBeat = 0 }

  // ======== Ø­Ù„Ù‚Ø© Ø§Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ========
  function animate(){ updateSpace(); drawSpaceBackground(); updateAudioBeat(); requestAnimationFrame(animate) }

  // Ø¨Ø¯Ø¡ Ø§Ù„Ø±Ø³ÙˆÙ…Ø§Øª
  animate(); drawHeartStep();

  // Ø¥Ø¹Ø§Ø¯Ø© ØªÙ‡ÙŠØ¦Ø© Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø¬Ù…: Ø¥Ø¹Ø§Ø¯Ø© Ø±Ø³Ù… Ø§Ù„Ù‚Ù„Ø¨ Ù…Ù† Ø§Ù„ØµÙØ±
  window.addEventListener('resize', ()=>{ resizeAll(); initSpace(); ctx.clearRect(0,0,W,H); stepI=0; prevX=null; heartPoints.length=0; isPulsing=false; drawHeartStep() });
  </script>
</body>
</html>
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ğŸ˜</title>
<style>
  html,body { height:100%; margin:0; background:black; }
  .wrap {
    <!DOCTYPE html>
    <html lang="ar" dir="rtl">
      <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>ğŸ˜</title>
        <style>
          html,
          body {
            height: 100%;
            margin: 0;
            background: black;
          }

          .wrap {
            position: relative;
            width: 100%;
            height: 100vh;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
          }

          canvas {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            display: block;
          }

          /* ØªØ±ØªÙŠØ¨ Ø§Ù„Ø·Ø¨Ù‚Ø§Øª: Ø§Ù„Ø®Ù„ÙÙŠØ© ØªØ­ØªØŒ Ø§Ù„Ù‚Ù„Ø¨ ÙÙˆÙ‚ */
          #bgCanvas {
            z-index: 1;
          }

          #heartCanvas {
            z-index: 2;
            pointer-events: none; /* Ø­ØªÙ‰ Ù„Ø§ ØªØ¹Ø·Ù„ Ø§Ù„ØªÙØ§Ø¹Ù„Ø§Øª */
          }
        </style>
      </head>

      <body>
        <div class="wrap">
          <canvas id="bgCanvas"></canvas>
          <canvas id="heartCanvas"></canvas>
        </div>
          <div class="wrap">
            <canvas id="bgCanvas"></canvas>

            <!-- Ø­Ø§ÙˆÙŠØ© Ù„ØªØ¯ÙˆÙŠØ± Ø§Ù„Ù‚Ù„Ø¨ Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ (pseudo 3D) -->
            <div id="heartWrapper">
              <canvas id="heartCanvas"></canvas>
            </div>

            <!-- ÙˆØ§Ø¬Ù‡Ø© ØªØ­ÙƒÙ… Ø¨Ø³ÙŠØ·Ø© -->
            <div id="ui">
              <label>Ù„ÙˆÙ† Ø§Ù„Ù‚Ù„Ø¨: <input id="colorPicker" type="color" value="#ff2d55"></label>
              <label>Ø§Ù„Ø±Ø³Ø§Ù„Ø©: <input id="msgInput" type="text" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§"></label>
              <button id="applyMsg">ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø³Ø§Ù„Ø©</button>
              <button id="exportBtn">ØªØµØ¯ÙŠØ± ØµÙˆØ±Ø©</button>
              <label>Ø£ÙˆØ¯ÙŠÙˆ: <input id="audioFile" type="file" accept="audio/*"></label>
              <button id="playAudio">ØªØ´ØºÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù</button>
              <label>Ø³Ø±Ø¹Ø© Ø§Ù„Ù†Ø¨Ø¶: <input id="pulseRange" type="range" min="0.5" max="3" step="0.05" value="1"></label>
            </div>
          </div>

        <script>
          /* ================= Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙƒØ§Ù†ÙØ§Ø³Ø§Øª ÙˆØ§Ù„Ù‚ÙŠØ§Ø³Ø§Øª ================= */
          const bgCanvas = document.getElementById("bgCanvas");
          const heartCanvas = document.getElementById("heartCanvas");
          const bgCtx = bgCanvas.getContext("2d");
          const ctx = heartCanvas.getContext("2d");

          function resizeAll() {
            const w = window.innerWidth;
            const h = window.innerHeight;
            [bgCanvas, heartCanvas].forEach((c) => {
              c.width = w;
              c.height = h;
            });
            centerX = Math.round(w / 2);
            centerY = Math.round(h / 2);
          }

          window.addEventListener("resize", resizeAll);

          let centerX = window.innerWidth / 2;
          let centerY = window.innerHeight / 2;
          resizeAll();

          /* ================= Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø§Ù„Ù‚Ù„Ø¨ Ø§Ù„ÙƒØ¨ÙŠØ±Ø© ================= */
          function heartX(k) {
            return 15 * Math.pow(Math.sin(k), 3);
          }

          function heartY(k) {
            return (
              12 * Math.cos(k) - 5 * Math.cos(2 * k) - 2 * Math.cos(3 * k) - Math.cos(4 * k)
            );
          }

          /* ================= Ù‚Ù„ÙˆØ¨/Ù†Ø¬ÙˆÙ… Ø§Ù„ÙØ¶Ø§Ø¡ (Ø§Ù„Ø®Ù„ÙÙŠØ© 3D) ================= */
          const spaceHearts = [];
          const SPACE_COUNT = 140;

          function initSpace() {
            spaceHearts.length = 0;
            for (let j = 0; j < SPACE_COUNT; j++) {
              spaceHearts.push({
                x: Math.random() * bgCanvas.width,
                y: Math.random() * bgCanvas.height,
                z: Math.random() * 3 + 0.5, // Ø¹Ù…Ù‚
                hue: Math.random() * 360,
                sizeBase: 0.6 + Math.random() * 1.8,
                vx: 0,
                vy: 0,
              });
            }
          }

              /* Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ù‚Ù„Ø¨ Ø«Ù„Ø§Ø«ÙŠØ© Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ */
              #heartWrapper{
                position: absolute;
                left:0; top:0; width:100%; height:100%;
                transform-style: preserve-3d;
                transition: transform 0.12s linear;
                display:flex; justify-content:center; align-items:center;
                pointer-events: none; /* ØªØ¹Ø§Ù…Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø¹Ù„Ù‰ Ø§Ù„wrap ÙÙ‚Ø· */
              }

              .wrap{ perspective: 900px; }

              /* ÙˆØ§Ø¬Ù‡Ø© Ø¨Ø³ÙŠØ·Ø© Ù„Ø¶Ø¨Ø· Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª */
              #ui{
                position: absolute; left: 12px; top: 12px; z-index: 9; color: #fff;
                display:flex; gap:8px; align-items:center; flex-wrap:wrap; font-family: sans-serif;
                background: rgba(0,0,0,0.25); padding:8px; border-radius:8px;
              }
              #ui input[type="text"]{ width:140px; }
          initSpace();

          // ØªØªØ¨Ø¹ Ø§Ù„Ù…Ø§ÙˆØ³ Ù„Ø¨Ù†Ø§Ø¡ ØªØ£Ø«ÙŠØ± Ø§Ù„ØªÙØ§Ø¹Ù„
          const mouse = { x: null, y: null };
          window.addEventListener("mousemove", (e) => {
            mouse.x = e.clientX;
            mouse.y = e.clientY;
          });

          function drawSpaceBackground() {
            // Ù†Ù…Ø³Ø­ Ø®Ù„ÙÙŠØ© ÙƒÙ„ ÙØ±ÙŠÙ…
            bgCtx.clearRect(0, 0, bgCanvas.width, bgCanvas.height);

            // Ù†Ø±Ø³Ù… Ø³Ù…Ø§Ø¡ Ù…Ù† Ù†Ù‚Ø§Ø·/Ù‚Ù„ÙˆØ¨ ØµØºÙŠØ±Ø© (ØªØªØ­Ø±Ùƒ Ù„Ø£Ø³ÙÙ„ Ø¨Ø­Ø³Ø¨ Ø§Ù„Ø¹Ù…Ù‚)
            for (let h of spaceHearts) {
              // ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø§Ù„Ù…Ø§ÙˆØ³: Ø¯ÙØ¹ Ø§Ù„Ù†Ø¬ÙˆÙ… Ø¨Ø¹ÙŠØ¯Ù‹Ø§ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø¨
              const mx = mouse.x,
                my = mouse.y;
              if (mx !== null && my !== null) {
                const dx = h.x - mx;
                const dy = h.y - my;
                const dist = Math.sqrt(dx * dx + dy * dy);
                const threshold = 120 * h.z; // Ù…Ø¯Ù‰ Ø§Ù„ØªÙØ§Ø¹Ù„ ÙŠØªØ£Ø«Ø± Ø¨Ø§Ù„Ø¹Ù…Ù‚
                if (dist < threshold && dist > 0) {
                  const force = ((threshold - dist) / threshold) * 6; // Ù‚ÙˆØ© Ø¯ÙØ¹
                  h.vx += (dx / dist) * force;
                  h.vy += (dy / dist) * force;
                }
              }

              // Ø§Ù„Ø­Ø±ÙƒØ© Ù…Ø¹ Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„Ø³Ø±Ø¹Ø© ÙˆØ§Ù„Ø²Ù…Ù†
              h.vx *= 0.92;
              h.vy *= 0.92;
              h.x += h.vx;
              h.y += h.vy + 0.4 * h.z; // Ø­Ø±ÙƒØ© Ù‡Ø¨ÙˆØ·ÙŠØ©

              // Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù†Ø¬Ù…/Ø§Ù„Ù‚Ù„Ø¨ Ù„Ùˆ Ø®Ø±Ø¬ Ù…Ù† Ø§Ù„Ø´Ø§Ø´Ø©
              if (h.y > bgCanvas.height + 20 || h.x < -50 || h.x > bgCanvas.width + 50) {
                h.y = -10 - Math.random() * 50;
                h.x = Math.random() * bgCanvas.width;
                h.z = Math.random() * 3 + 0.5;
                h.hue = Math.random() * 360;
                h.vx = 0;
                h.vy = 0;
              }

              const r = h.sizeBase * h.z;
              // Ù†Ø±Ø³Ù… Ù‚Ù„ÙˆØ¨ (Emoji) Ø¨Ø¯Ù„Ù‹Ø§ Ù…Ù† Ø¯ÙˆØ§Ø¦Ø±
              bgCtx.fillStyle = `hsl(${h.hue}, 90%, 60%)`;
              bgCtx.textAlign = "center";
              bgCtx.textBaseline = "middle";
              bgCtx.font = `${Math.max(8, Math.round(r * 8))}px serif`;
              bgCtx.fillText("â¤", h.x, h.y);
            }
          }

          /* ================= Ø±Ø³Ù… Ø§Ù„Ù‚Ù„Ø¨ ØªØ¯Ø±ÙŠØ¬ÙŠÙ‹Ø§ (Ø«Ø§Ø¨Øª Ø¹Ù„Ù‰ ÙƒØ§Ù†ÙØ§Ø³ Ø¹Ù„ÙˆÙŠ) ================= */
          let stepI = 0;
          let prevX = null,
            prevY = null;
          const heartPoints = []; // Ù„ØªØ®Ø²ÙŠÙ† Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚Ù„Ø¨ Ù„Ù„Ø±Ø³Ù… ÙˆØ§Ù„Ù†Ø¨Ø¶ Ù„Ø§Ø­Ù‚Ù‹Ø§
          let isPulsing = false;
          const scale = 20;
          const numSteps = 3500; // Ø¹Ø¯Ø¯ Ø§Ù„Ø®Ø·ÙˆØ§Øª (ÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ±Ù‡)

          function drawHeartStep() {
            // Ù„Ø§ Ù†Ù…Ø³Ø­ ÙƒØ§Ù†ÙØ§Ø³ Ø§Ù„Ù‚Ù„Ø¨ â€” Ø­ØªÙ‰ ØªØ¨Ù‚Ù‰ Ø§Ù„Ø®Ø·ÙˆØ· Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ù…ØªØ¬Ù…Ø¹Ø© (persistent)
            // ÙÙ‚Ø· Ù†Ø±Ø³Ù… Ø®Ø·ÙˆØ© Ø¬Ø¯ÙŠØ¯Ø© Ù…Ù† Ø§Ù„Ù‚Ù„Ø¨
            const t = stepI;
            const x = heartX(t) * scale + centerX;
            const y = -heartY(t) * scale + centerY;

            const hue = (t / numSteps) * 360;
            ctx.strokeStyle = `hsl(${hue}, 100%, 50%)`;
            ctx.lineWidth = 2;

            if (prevX !== null && prevY !== null) {
              ctx.beginPath();
              ctx.moveTo(prevX, prevY);
              ctx.lineTo(x, y);
              // ØªÙˆÙ‡Ø¬ Ø¨Ø³ÙŠØ· Ù„Ù„Ù‚Ù„Ø¨
              ctx.shadowColor = ctx.strokeStyle;
              ctx.shadowBlur = 15;
              ctx.stroke();
              // Ø£Ø·ÙØ¦ Ø§Ù„Ø¸Ù„ Ø¨Ø¹Ø¯ Ø§Ù„Ø±Ø³Ù… Ù„Ø¹Ø¯Ù… ØªØ£Ø«ÙŠØ±Ù‡ Ø¹Ù„Ù‰ Ø±Ø³ÙˆÙ…Ø§Øª Ø£Ø®Ø±Ù‰
              ctx.shadowBlur = 0;
            }

            // Ø®Ø²Ù‘Ù† Ø§Ù„Ù†Ù‚Ø·Ø© Ø¨Ø§Ù„Ù†Ø³Ø¨Ø© Ù„Ù„Ù…Ø±ÙƒØ² Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ ÙÙŠ Ù†Ø¨Ø¶ Ø§Ù„Ù‚Ù„Ø¨ Ù„Ø§Ø­Ù‚Ù‹Ø§
            heartPoints.push({ dx: x - centerX, dy: y - centerY, hue });
            prevX = x;
            prevY = y;
            stepI++;

            // Ù†ÙƒÙ…Ù„ Ø­ØªÙ‰ Ù†ØµÙ„ Ù„Ù„Ù†Ù‡Ø§ÙŠØ©Ø› ÙˆØ¥Ù„Ø§ Ù†Ù‚Ù
            if (stepI < numSteps) {
              requestAnimationFrame(drawHeartStep);
            } else {
              // Ø¹Ù†Ø¯ Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„Ø±Ø³Ù…ØŒ Ù†Ø¨Ø¯Ø£ ØªØ£Ø«ÙŠØ± Ø§Ù„Ù†Ø¨Ø¶ Ø§Ù„Ù…Ø³ØªÙ…Ø±
              isPulsing = true;
              pulseHeart();
            }
          }

          function pulseHeart() {
            if (!isPulsing) return;
            // Ù†Ù…Ø³Ø­ ÙƒØ§Ù†ÙØ§Ø³ Ø§Ù„Ù‚Ù„Ø¨ Ø«Ù… Ù†Ø¹ÙŠØ¯ Ø±Ø³Ù… Ø§Ù„Ù…Ø³Ø§Ø± ÙƒØ§Ù…Ù„Ø§Ù‹ Ù…Ø¹ Ù…Ù‚ÙŠØ§Ø³ ØµØºÙŠØ± Ù…ØªØºÙŠØ±
            ctx.clearRect(0, 0, heartCanvas.width, heartCanvas.height);

            const time = Date.now();
            const s = 1 + 0.03 * Math.sin(time / 160);

            ctx.save();
            ctx.translate(centerX, centerY);
            ctx.scale(s, s);
            ctx.lineWidth = 2;

            // Ù†Ø±Ø³Ù… ÙƒÙ„ Ø§Ù„Ù‚Ø·Ø¹ ÙƒØ®Ø·ÙˆØ· Ù…ØªØªØ§Ø¨Ø¹Ø© Ù…Ø¹ ØªÙˆÙ‡Ø¬
            ctx.shadowBlur = 20;
            for (let i = 1; i < heartPoints.length; i++) {
              const a = heartPoints[i - 1];
              const b = heartPoints[i];
              ctx.beginPath();
              ctx.moveTo(a.dx, a.dy);
              ctx.lineTo(b.dx, b.dy);
              ctx.strokeStyle = `hsl(${b.hue}, 100%, 50%)`;
              ctx.shadowColor = ctx.strokeStyle;
              ctx.stroke();
            }

            ctx.shadowBlur = 0;
            ctx.restore();

            requestAnimationFrame(pulseHeart);
          }

          /* ================= Ø­Ù„Ù‚Ø© Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…Ø³ØªÙ…Ø±Ø© ================= */
          function animateBackground() {
            drawSpaceBackground();
            requestAnimationFrame(animateBackground);
          }

          /* ================= Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø±Ø³ÙˆÙ…Ø§Øª ================= */
          animateBackground(); // Ø§Ù„Ø®Ù„ÙÙŠØ© ØªØ¨Ø¯Ø£ ÙÙˆØ±Ù‹Ø§ ÙˆØªØ³ØªÙ…Ø±
          drawHeartStep(); // Ø§Ù„Ù‚Ù„Ø¨ ÙŠØ¨Ø¯Ø£ Ø¨Ø§Ù„ØªÙƒÙˆÙ‘Ù† ØªØ¯Ø±ÙŠØ¬ÙŠØ§Ù‹

          /* ================= Ø¥Ø°Ø§ ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø¬Ù… -> Ø£Ø¹Ø¯ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¬ÙˆÙ… ÙˆØ§Ù„Ø­Ø³Ø§Ø¨Ø§Øª ================= */
          window.addEventListener("resize", () => {
            resizeAll();
            initSpace();
            // Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø¬Ù… Ù†Ø¹ÙŠØ¯ ØªÙ‡ÙŠØ¦Ø© Ø±Ø³Ù… Ø§Ù„Ù‚Ù„Ø¨: Ù†Ù…Ø³Ø­ Ø§Ù„ÙƒØ§Ù†ÙØ§Ø³ Ø§Ù„Ø¹Ù„ÙˆÙŠØŒ Ù†Ø¹ÙŠØ¯ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
            ctx.clearRect(0, 0, heartCanvas.width, heartCanvas.height);
            stepI = 0;
            prevX = null;
            prevY = null;
            heartPoints.length = 0;
            isPulsing = false;
            // Ù†Ø¨Ø¯Ø£ Ø±Ø³Ù… Ø§Ù„Ù‚Ù„Ø¨ Ù…Ù† Ø¬Ø¯ÙŠØ¯
            drawHeartStep();
          });
        </script>
      </body>
    </html>
  stepI++;

  // Ù†ÙƒÙ…Ù„ Ø­ØªÙ‰ Ù†ØµÙ„ Ù„Ù„Ù†Ù‡Ø§ÙŠØ©Ø› ÙˆØ¥Ù„Ø§ Ù†Ù‚Ù
  if (stepI < numSteps){
    requestAnimationFrame(drawHeartStep);
  } else {
    // Ø¹Ù†Ø¯ Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„Ø±Ø³Ù…ØŒ Ù†Ø¨Ø¯Ø£ ØªØ£Ø«ÙŠØ± Ø§Ù„Ù†Ø¨Ø¶ Ø§Ù„Ù…Ø³ØªÙ…Ø±
    isPulsing = true;
    pulseHeart();
  }
}

function pulseHeart(){
  if (!isPulsing) return;
  // Ù†Ù…Ø³Ø­ ÙƒØ§Ù†ÙØ§Ø³ Ø§Ù„Ù‚Ù„Ø¨ Ø«Ù… Ù†Ø¹ÙŠØ¯ Ø±Ø³Ù… Ø§Ù„Ù…Ø³Ø§Ø± ÙƒØ§Ù…Ù„Ø§Ù‹ Ù…Ø¹ Ù…Ù‚ÙŠØ§Ø³ ØµØºÙŠØ± Ù…ØªØºÙŠØ±
  ctx.clearRect(0,0,heartCanvas.width, heartCanvas.height);

  const time = Date.now();
  const s = 1 + 0.03 * Math.sin(time / 160);

  ctx.save();
  ctx.translate(centerX, centerY);
  ctx.scale(s, s);
  ctx.lineWidth = 2;

  // Ù†Ø±Ø³Ù… ÙƒÙ„ Ø§Ù„Ù‚Ø·Ø¹ ÙƒØ®Ø·ÙˆØ· Ù…ØªØªØ§Ø¨Ø¹Ø© Ù…Ø¹ ØªÙˆÙ‡Ø¬
  ctx.shadowBlur = 20;
  for (let i=1;i<heartPoints.length;i++){
    const a = heartPoints[i-1];
    const b = heartPoints[i];
    ctx.beginPath();
    ctx.moveTo(a.dx, a.dy);
    ctx.lineTo(b.dx, b.dy);
    ctx.strokeStyle = `hsl(${b.hue}, 100%, 50%)`;
    ctx.shadowColor = ctx.strokeStyle;
    ctx.stroke();
  }

  ctx.shadowBlur = 0;
  ctx.restore();

  requestAnimationFrame(pulseHeart);
}

/* ================= Ø­Ù„Ù‚Ø© Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…Ø³ØªÙ…Ø±Ø© ================= */
function animateBackground(){
  drawSpaceBackground();
  requestAnimationFrame(animateBackground);
}

/* ================= Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø±Ø³ÙˆÙ…Ø§Øª ================= */
animateBackground();  // Ø§Ù„Ø®Ù„ÙÙŠØ© ØªØ¨Ø¯Ø£ ÙÙˆØ±Ù‹Ø§ ÙˆØªØ³ØªÙ…Ø±
drawHeartStep();      // Ø§Ù„Ù‚Ù„Ø¨ ÙŠØ¨Ø¯Ø£ Ø¨Ø§Ù„ØªÙƒÙˆÙ‘Ù† ØªØ¯Ø±ÙŠØ¬ÙŠØ§Ù‹

/* ================= Ø¥Ø°Ø§ ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø¬Ù… -> Ø£Ø¹Ø¯ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¬ÙˆÙ… ÙˆØ§Ù„Ø­Ø³Ø§Ø¨Ø§Øª ================= */
window.addEventListener('resize', ()=>{
  resizeAll();
  initSpace();
  // Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø¬Ù… Ù†Ø¹ÙŠØ¯ ØªÙ‡ÙŠØ¦Ø© Ø±Ø³Ù… Ø§Ù„Ù‚Ù„Ø¨: Ù†Ù…Ø³Ø­ Ø§Ù„ÙƒØ§Ù†ÙØ§Ø³ Ø§Ù„Ø¹Ù„ÙˆÙŠØŒ Ù†Ø¹ÙŠØ¯ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
  ctx.clearRect(0,0,heartCanvas.width, heartCanvas.height);
  stepI = 0;
  prevX = null; prevY = null;
  heartPoints.length = 0;
  isPulsing = false;
  // Ù†Ø¨Ø¯Ø£ Ø±Ø³Ù… Ø§Ù„Ù‚Ù„Ø¨ Ù…Ù† Ø¬Ø¯ÙŠØ¯
  drawHeartStep();
});
</script>
</body>
</html>

